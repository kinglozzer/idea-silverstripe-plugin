plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '0.6.5'
    id 'org.jetbrains.changelog' version '1.1.1'
}

group 'com.kinglozzer'
version '0.3.2'

sourceSets {
    main.java.srcDirs = ['src/main/java', 'src/main/gen']
}

repositories {
    mavenCentral()
}

apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'org.jetbrains.intellij'
apply plugin: 'org.jetbrains.changelog'

intellij {
    version 'IC-2020.3'

    patchPluginXml {
        version = project.version
        untilBuild = null
        changeNotes({ changelog.get(project.version).toHTML() })
    }
}

test {
    testLogging {
        exceptionFormat = 'full'
    }
}

tasks {
    buildSearchableOptions {
        // Disabled as temporary workaround for https://youtrack.jetbrains.com/issue/KTIJ-699
        enabled(false)
    }
}

changelog {
    version = project.version
    path = "${project.projectDir}/CHANGELOG.md"
    header = { "[$version]" }
    itemPrefix = "-"
    keepUnreleasedSection = true
    unreleasedTerm = "[Unreleased]"
    groups = ["Added", "Changed", "Deprecated", "Removed", "Fixed"]
}
